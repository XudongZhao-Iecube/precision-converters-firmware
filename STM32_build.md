# STM32 Project Build Guide

## Checking Out the Project Repository
Run below commands to checkout the git repository and all dependancies (submodules) into local drive of your computer:

```
git clone --recursive https://github.com/mphalke/precision-converters-firmware
cd precision-converters-firmware
```


## Updating Library Dependancy
Update the commit ID of ADI library repositories (whichever applicables) for respective target firmware application.

*Refer the 'library_dependancy.txt' file from respective project folder to know the specific commit ID for each library*

```
cd libs/no-OS
git checkout your_commit_id
cd libs/libtinyiiod
git checkout your_commit_id
```


## Create a new STM32CubeIDE project from an existing (pre-generated) .ioc file

  **`Step 1: Open STM32CubeMX and select File->Load Project... `**

  <img src="https://user-images.githubusercontent.com/62383520/147866801-8242e48c-a78b-43cd-bfb0-82f77374ac0c.png" width="400">
  
  ----------------------------------------------------------------------------------------
  
  **`Step 2: Select the STM32CubeIDE as default Toolchain/IDE. Rest of the configurations should be taken from pre-generated .ioc file `**
  
  <img src="https://user-images.githubusercontent.com/62383520/147866926-8773b4d5-c1a7-44d2-9cc9-e350f7eb7aa6.png" width="600">
  
   ----------------------------------------------------------------------------------------
   
   **`Step 3: Click on 'GENERATE CODE' button on the top right corner to generate the STM32 device specific code`**

  <img src="https://user-images.githubusercontent.com/62383520/147867048-33c7660b-1818-4aa5-81f0-35b2deee6d35.png" width="600">
  

## Updating the project settings
By default, the STM32CubeIDE automatically generates the 'Makefile' which is used to build/compile the project.
The application specific source and header files are not manually included into the project settings due to complexity in doing that
and also there dependancies on the specific application. The source and header files are therefore included from pre-generated 'Makefile'
which is present in the same directory where .ioc file is present. This Makefile should be used to build the STM32 project and so
user need to override the automatically generate Makefile setting from STM32CubeIDE as shown below:

1. Right click on project and select 'Properties'.
2. Select the C/C++ Build option. Uncheck the 'Generate Makefiles Automatically' option and set the Build location as shown below:
 
   <img src="https://user-images.githubusercontent.com/62383520/147867904-77b45244-b002-4231-9685-e5a10d66f8c8.png" width="400">
  
3. Link the files and folders manually for editing application source code (optional)

   *If you wish to modify the application code from STM32CubeIDE, you need to manually link the source files and folders by dragging and 
   dropping them into project in STM32CubeIDE, as the autogenerated project does not show them automatically in project.*

   <img src="https://user-images.githubusercontent.com/62383520/147868143-15778e48-7139-4ac8-af0c-b5d3cc34ba67.png" width="400">

   <img src="https://user-images.githubusercontent.com/62383520/147868063-b7f07b93-bcbd-47ae-9c17-6d1d3444f31a.png" width="200">

4. Now compile the project by right clicking on project and selecting 'Build Project'.


## Debug the STM32CubeIDE Project
1. Right click on the project and select 'Debug As -> Debug Configurations..." option.
2. Create a new debug configuration as shown below:

   <img src="https://user-images.githubusercontent.com/62383520/147872452-0063b8e3-aba6-4492-a5c2-21a2939fde70.png" width="200">
   
   <img src="https://user-images.githubusercontent.com/62383520/147872501-06bdd8ea-d8f9-4696-8f47-2b8fcfef19f1.png" width="200">
   
    <img src="https://user-images.githubusercontent.com/62383520/147872536-88ffa2a6-f5eb-43e4-ad24-d5b5cfb4b823.png" width="200">
    
3. Apply the settings and click on debug button to start the debugging.


## Using Command Line to Build the Project
Type command 'make' on command line window (e.g. command prompt, git bash, etc) to build the project.
To clean build the project, type command 'make clean' followed by 'make.
